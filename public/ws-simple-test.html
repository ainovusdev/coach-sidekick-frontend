<!DOCTYPE html>
<html>
<head>
    <title>Simple WebSocket Test</title>
</head>
<body>
    <h1>Simple WebSocket Test</h1>
    <button onclick="test0()">Test Direct (/ws-test)</button>
    <button onclick="test1()">Test Basic (/ws/test)</button>
    <button onclick="test2()">Test Debug (/ws/debug)</button>
    <button onclick="test3()">Test Auth (/ws)</button>
    <pre id="log"></pre>

    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += msg + '\n';
        }

        function test0() {
            log('Testing ws://localhost:8000/ws-test');
            const ws = new WebSocket('ws://localhost:8000/ws-test');
            ws.onopen = () => log('✓ /ws-test connected');
            ws.onmessage = (e) => log('Message: ' + e.data);
            ws.onerror = (e) => log('✗ Error: ' + e);
            ws.onclose = (e) => log('Closed: ' + e.code + ' ' + e.reason);
        }

        function test1() {
            log('Testing ws://localhost:8000/ws/test');
            const ws = new WebSocket('ws://localhost:8000/ws/test');
            ws.onopen = () => log('✓ /ws/test connected');
            ws.onmessage = (e) => log('Message: ' + e.data);
            ws.onerror = (e) => log('✗ Error: ' + e);
            ws.onclose = (e) => log('Closed: ' + e.code + ' ' + e.reason);
        }

        function test2() {
            const token = localStorage.getItem('auth_token') || 'test-token';
            const url = `ws://localhost:8000/ws/debug?token=${token}`;
            log('Testing ' + url);
            const ws = new WebSocket(url);
            ws.onopen = () => log('✓ /ws/debug connected');
            ws.onmessage = (e) => log('Message: ' + e.data);
            ws.onerror = (e) => log('✗ Error: ' + e);
            ws.onclose = (e) => log('Closed: ' + e.code + ' ' + e.reason);
        }

        function test3() {
            const token = localStorage.getItem('auth_token');
            if (!token) {
                log('No token in localStorage!');
                return;
            }
            const url = `ws://localhost:8000/ws?token=${encodeURIComponent(token)}`;
            log('Testing ' + url.substring(0, 50) + '...');
            const ws = new WebSocket(url);
            ws.onopen = () => log('✓ /ws connected');
            ws.onmessage = (e) => log('Message: ' + e.data);
            ws.onerror = (e) => log('✗ Error: ' + e);
            ws.onclose = (e) => log('Closed: ' + e.code + ' ' + e.reason);
        }
    </script>
</body>
</html>